appId: dev.expo.updatese2e
onFlowStart:
  - runScript: ./maestroUpdatesApi.js
  - evalScript:
      script:  ${output.api.restartUpdatesServer()}
      label: Restart updates server
---
- evalScript:
    script:  ${output.api.serveManifest('test-update-with-invalid-asset-hash', MAESTRO_PLATFORM)}
    label: Setup updates server to serve an update with invalid asset hash
    env:
      MAESTRO_PLATFORM: ${MAESTRO_PLATFORM}
- launchApp
- assertVisible:
    label: Assert embedded update is visible
    text: "maestroString test"
- evalScript:
    script: ${output.api.delay(3000)}
    label: Delay for 3 seconds
- assertTrue:
    condition:  ${output.api.staticFileCount() == 4}
    label: Assert that exactly 4 static files were requested
- stopApp
- launchApp
- assertVisible:
    label: Assert that the update was not applied because of the invalid asset hash
    text: "maestroString test"
- stopApp
